<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>{{ page.title | default: site.title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="{{ '/public/favicon.svg' | relative_url }}" type="image/svg+xml">

    <style>
      :root { 
        /* Dark mode as default */
        --primary-green: #00c805;
        --primary-red: #ff5722;
        --dark-bg: #0d1117;
        --darker-bg: #010409;
        --card-bg: #161b22;
        --light-bg: #0d1117;
        --gray-100: #21262d;
        --gray-200: #30363d;
        --gray-300: #484f58;
        --gray-400: #656d76;
        --gray-500: #8b949e;
        --gray-600: #b1bac4;
        --gray-700: #c9d1d9;
        --gray-800: #f0f6fc;
        --gray-900: #ffffff;
        --text-primary: #f0f6fc;
        --text-secondary: #8b949e;
        --border-color: #30363d;
        --shadow: 0 2px 8px rgba(0,0,0,0.6);
        --shadow-hover: 0 4px 16px rgba(0,0,0,0.8);
        --accent-bg: rgba(0, 200, 5, 0.1);
        --accent-border: rgba(0, 200, 5, 0.3);
        color-scheme: dark;
      }

      /* Light mode override only if explicitly preferred */
      [data-theme="light"] {
        --dark-bg: #ffffff;
        --darker-bg: #f8f9fa;
        --card-bg: #ffffff;
        --light-bg: #ffffff;
        --gray-100: #f8f9fa;
        --gray-200: #e9ecef;
        --gray-300: #dee2e6;
        --gray-400: #ced4da;
        --gray-500: #adb5bd;
        --gray-600: #6c757d;
        --gray-700: #495057;
        --gray-800: #343a40;
        --gray-900: #212529;
        --text-primary: #212529;
        --text-secondary: #6c757d;
        --border-color: #e0e6ed;
        --shadow: 0 2px 8px rgba(0,0,0,0.08);
        --shadow-hover: 0 4px 16px rgba(0,0,0,0.12);
        --accent-bg: rgba(0, 200, 5, 0.05);
        --accent-border: rgba(0, 200, 5, 0.2);
        color-scheme: light;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        margin: 0;
        padding: 0;
        line-height: 1.6;
        background: var(--light-bg);
        color: var(--text-primary);
        font-size: 16px;
        font-weight: 400;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1.5rem;
      }

      header {
        background: var(--light-bg);
        border-bottom: 1px solid var(--border-color);
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(10px);
        background: rgba(13, 17, 23, 0.95);
      }

      [data-theme="light"] header {
        background: rgba(255, 255, 255, 0.95);
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
      }

      .logo {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary-green);
        text-decoration: none;
        margin: 0;
      }

      nav {
        display: flex;
        gap: 2rem;
      }

      nav a {
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s ease;
        padding: 0.5rem 0;
        position: relative;
      }

      nav a:hover,
      nav a.active {
        color: var(--text-primary);
      }

      nav a:hover::after {
        content: '';
        position: absolute;
        bottom: -1px;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--primary-green);
      }

      main {
        padding: 2rem 0;
        min-height: 70vh;
      }

      .content-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow);
        transition: box-shadow 0.2s ease;
        /* Allow horizontal scroll inside cards when a child (eg. wide table) exceeds
           the card width. This prevents the table from overflowing the page layout
           while still allowing users to scroll to see full content. */
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .content-card:hover {
        box-shadow: var(--shadow-hover);
      }

      h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin: 0 0 1rem 0;
        color: var(--text-primary);
        letter-spacing: -0.02em;
      }

      h2 {
        font-size: 1.75rem;
        font-weight: 600;
        margin: 2rem 0 1rem 0;
        color: var(--text-primary);
        letter-spacing: -0.01em;
      }

      h3 {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 1.5rem 0 0.75rem 0;
        color: var(--text-primary);
      }

      p {
        color: var(--text-secondary);
        margin-bottom: 1rem;
      }

      .meta {
        color: var(--text-secondary);
        font-size: 0.875rem;
        font-weight: 400;
      }

      /* Code and pre styling */
      pre {
        background: var(--gray-100);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        overflow-x: auto;
        font-size: 0.875rem;
        line-height: 1.5;
      }

      code {
        font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        background: var(--gray-100);
        padding: 0.2em 0.4em;
        border-radius: 4px;
        font-size: 0.875em;
      }

      pre code {
        background: none;
        padding: 0;
      }

      /* Table styling - Robinhood inspired dark theme */
      table {
        width: 100%;
        max-width: 100%;
        /* Slightly smaller table font to improve density and reduce overflow */
        font-size: 0.875rem;
        border-collapse: collapse;
        margin: 1.5rem 0;
        background: var(--card-bg);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: var(--shadow);
        border: 1px solid var(--border-color);
      }

      th {
        background: var(--gray-200);
        color: var(--text-primary);
        font-weight: 600;
        text-align: left;
        padding: 1rem;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        border-bottom: 1px solid var(--border-color);
      }

      td {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        color: var(--text-secondary);
        vertical-align: top;
        /* Allow long or unbroken content (like long URLs or long numbers) to wrap
           inside table cells instead of forcing the table to grow beyond its
           container. overflow-wrap: anywhere gives the browser flexibility to
           break words when necessary. */
        word-break: break-word;
        overflow-wrap: anywhere;
        white-space: normal;
      }

      tbody tr:hover {
        background: var(--gray-100);
      }

      tbody tr:last-child td {
        border-bottom: none;
      }

      /* Mermaid container styling */
      .mermaid {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 2rem;
        margin: 2rem 0;
        text-align: center;
        box-shadow: var(--shadow);
        font-family: "SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace;
      }

      /* Ensure mermaid/SVG labels are not rendered italic by default; makes
         diagram labels more readable on phones and small screens. */
      svg text, svg tspan, .mermaid text, .mermaid tspan, .mermaid .label, .mermaid .nodeLabel {
        font-style: normal !important;
        font-family: "SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace;
      }

      /* List styling */
      ul, ol {
        padding-left: 1.5rem;
        margin-bottom: 1rem;
      }

      li {
        margin-bottom: 0.5rem;
        color: var(--text-secondary);
      }

      /* Latest report small UI */
      .latest-report {
        display: flex;
        gap: 0.5rem;
        align-items: baseline;
        margin-bottom: 1rem;
      }

      .latest-report a {
        color: var(--text-primary);
        font-weight: 700;
      }

      .latest-report small {
        color: var(--text-secondary);
        font-weight: 400;
        margin-left: 0.5rem;
      }

      /* Embedded report styling */
      .embedded-report {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
  border: 1px solid var(--border-color);
  padding: 1rem;
  border-radius: 8px;
  margin: 1rem 0 1.5rem 0;
  min-height: 80vh;
  max-height: 80vh;
  overflow: auto;
      }

      .embedded-report img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0.5rem 0;
      }

      .embedded-report .mermaid {
        padding: 1rem;
        margin: 0.5rem 0;
      }

      @media (max-width: 768px) {
        .embedded-report { min-height: 60vh; max-height: 60vh; }
      }

      /* Footer */
      footer {
        background: var(--gray-100);
        border-top: 1px solid var(--border-color);
        padding: 2rem 0;
        margin-top: 4rem;
        text-align: center;
      }

      /* Responsive design */
      @media (max-width: 768px) {
        .container {
          padding: 0 1rem;
        }

        .header-content {
          flex-direction: column;
          gap: 1rem;
          text-align: center;
        }

        nav {
          gap: 1rem;
        }

        h1 {
          font-size: 2rem;
        }

        .content-card {
          padding: 1.5rem;
        }

        /* Make tables more compact on small screens */
        table {
          font-size: 0.8rem;
        }

        th, td {
          padding: 0.5rem 0.6rem;
        }
      }

      /* Accent colors for financial data */
      .positive {
        color: var(--primary-green);
        font-weight: 600;
      }

      .negative {
        color: var(--primary-red);
        font-weight: 600;
      }

      .neutral {
        color: var(--text-secondary);
      }

      /* Pixel art heart */
      .pixel-heart {
        display: inline-block;
        width: 15px;
        height: 13px;
        position: relative;
        transform: scale(1.2);
        margin: 0 4px;
      }

      .pixel-heart::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 1px;
        height: 1px;
        background: var(--primary-red);
        box-shadow: 
          /* Row 1 - top hearts */
          1px 0 0 var(--primary-red),
          2px 0 0 var(--primary-red),
          5px 0 0 var(--primary-red),
          6px 0 0 var(--primary-red),
          7px 0 0 var(--primary-red),
          
          /* Row 2 */
          0 1px 0 var(--primary-red),
          1px 1px 0 var(--primary-red),
          2px 1px 0 var(--primary-red),
          3px 1px 0 var(--primary-red),
          4px 1px 0 var(--primary-red),
          5px 1px 0 var(--primary-red),
          6px 1px 0 var(--primary-red),
          7px 1px 0 var(--primary-red),
          8px 1px 0 var(--primary-red),
          
          /* Row 3 */
          0 2px 0 var(--primary-red),
          1px 2px 0 var(--primary-red),
          2px 2px 0 var(--primary-red),
          3px 2px 0 var(--primary-red),
          4px 2px 0 var(--primary-red),
          5px 2px 0 var(--primary-red),
          6px 2px 0 var(--primary-red),
          7px 2px 0 var(--primary-red),
          8px 2px 0 var(--primary-red),
          
          /* Row 4 */
          0 3px 0 var(--primary-red),
          1px 3px 0 var(--primary-red),
          2px 3px 0 var(--primary-red),
          3px 3px 0 var(--primary-red),
          4px 3px 0 var(--primary-red),
          5px 3px 0 var(--primary-red),
          6px 3px 0 var(--primary-red),
          7px 3px 0 var(--primary-red),
          8px 3px 0 var(--primary-red),
          
          /* Row 5 */
          1px 4px 0 var(--primary-red),
          2px 4px 0 var(--primary-red),
          3px 4px 0 var(--primary-red),
          4px 4px 0 var(--primary-red),
          5px 4px 0 var(--primary-red),
          6px 4px 0 var(--primary-red),
          7px 4px 0 var(--primary-red),
          
          /* Row 6 */
          2px 5px 0 var(--primary-red),
          3px 5px 0 var(--primary-red),
          4px 5px 0 var(--primary-red),
          5px 5px 0 var(--primary-red),
          6px 5px 0 var(--primary-red),
          
          /* Row 7 */
          3px 6px 0 var(--primary-red),
          4px 6px 0 var(--primary-red),
          5px 6px 0 var(--primary-red),
          
          /* Row 8 - bottom point */
          4px 7px 0 var(--primary-red);
      }

      .pixel-heart:hover::before {
        animation: pixelHeartBeat 0.6s ease;
      }

      @keyframes pixelHeartBeat {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.2); }
      }

      /* Override site-generated rules that force no-wrap for CSV or markdown tables.
         These selectors are intentionally specific and scoped to .content-card so
         they don't affect other parts of the site unexpectedly. */
      .content-card .markdown-body .csv-data td,
      .content-card .markdown-body .csv-data th,
      .content-card .no-wrap {
        white-space: normal !important;
        word-break: break-word;
        overflow-wrap: anywhere;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container">
        <div class="header-content">
          <a href="{{ '/' | relative_url }}" class="logo">{{ site.title | default: "Investment Place" }}</a>
          <nav>
            <a href="{{ '/' | relative_url }}">Home</a>
            <a href="{{ '/foresee/' | relative_url }}">Weekly Foresee</a>
            <a href="{{ '/report/' | relative_url }}">Daily Report</a>
            <a href="{{ '/conventions/' | relative_url }}">Conventions</a>
          </nav>
        </div>
      </div>
    </header>

    <main>
      <div class="container">
        <div class="content-card">
          {{ content }}
        </div>
      </div>
    </main>

    <footer>
      <div class="container">
        <p class="meta">Made by Ziang with <span class="pixel-heart"></span></p>
      </div>
    </footer>

    <!-- RoughJS: Required for svg2roughjs -->
    <script src="{{ '/public/rough.js' | relative_url }}"></script>
    
    <!-- svg2roughjs: Convert SVG to hand-drawn style -->
    <script src="{{ '/public/svg2roughjs.umd.min.js' | relative_url }}"></script>
    
    <!-- Mermaid: client-side render of ```mermaid code fences -->
    <script src="{{ '/public/mermaid.min.js' | relative_url }}"></script>
    <script>
      (function () {
        function transformCodeBlocks() {
          var codes = document.querySelectorAll('code.language-mermaid, code.mermaid');
          codes.forEach(function (code) {
            var target = code.closest('div.language-mermaid') || code.closest('div.highlight') || code.closest('pre') || code.parentElement;
            if (!target) return;
            var container = document.createElement('div');
            container.className = 'mermaid';
            container.textContent = code.textContent;
            target.replaceWith(container);
          });
        }

        function renderMermaid() {
          try {
            if (!window.mermaid) {
              console.error('Mermaid library not loaded from local file');
              return;
            }
            
            // Check if libraries are available
            console.log('RoughJS loaded:', typeof rough !== 'undefined');
            console.log('svg2roughjs loaded:', typeof svg2roughjs !== 'undefined');
            console.log('Mermaid loaded:', typeof mermaid !== 'undefined');
            
            mermaid.initialize({ 
              startOnLoad: false, 
              securityLevel: 'loose', 
              theme: 'dark',
              look: 'classic',
              handDrawnSeed: 42,
              logLevel: 'debug',
              themeVariables: {
                primaryColor: '#5b6d49',
                primaryTextColor: '#f0f6fc',
                primaryBorderColor: '#30363d',
                lineColor: '#8b949e',
                sectionBkgColor: '#161b22',
                altSectionBkgColor: '#21262d',
                gridColor: '#30363d',
                secondaryColor: '#161b22',
                tertiaryColor: '#21262d',
                background: '#0d1117',
                mainBkg: '#161b22',
                secondBkg: '#21262d',
                tertiaryBkg: '#30363d'
              },
              flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
              },
              timeline: {
                useMaxWidth: true,
                htmlLabels: true
              }
            });
            
            // Log the configuration to verify handDrawn settings (only if getConfig exists)
            if (typeof mermaid.getConfig === 'function') {
              console.log('Mermaid config after init:', mermaid.getConfig());
              console.log('HandDrawn look setting:', mermaid.getConfig().look);
            } else {
              console.log('Mermaid version is older - getConfig() not available');
              console.log('HandDrawn feature may not be supported in this version');
            }
            
            transformCodeBlocks();
            // Use the newer run method instead of deprecated init
            mermaid.run().then(() => {
              // Apply rough effect using svg2roughjs
              applyRoughEffect();
            });
          } catch (e) {
            console.error('Mermaid render error', e);
          }
        }

        function applyRoughEffect() {
          if (typeof svg2roughjs === 'undefined') {
            console.warn('svg2roughjs not available for rough effect');
            return;
          }

          const mermaidContainers = document.querySelectorAll('.mermaid');
          
          mermaidContainers.forEach(container => {
            const svg = container.querySelector('svg');
            if (!svg) return;

            try {
              // Create svg2roughjs converter with options
              const options = {
                roughness: 1.2,
                bowing: 1,
                stroke: '#8b949e',
                strokeWidth: 1.5,
                fillStyle: 'solid',
                seed: 42
              };
              
              const svgConverter = new svg2roughjs.Svg2Roughjs(container, options);
              svgConverter.svg = svg;
              
              // Apply the sketch effect
              svgConverter.sketch();
              
              // Hide the original SVG
              svg.style.display = 'none';
              
              // Style the rough version (could be canvas or svg)
              const roughElement = container.querySelector('canvas') || container.querySelector('svg:last-child');
              if (roughElement && roughElement !== svg) {
                // Make canvas/svg responsive
                roughElement.style.width = '100%';
                roughElement.style.height = 'auto';
                roughElement.style.maxWidth = '100%';
                roughElement.style.display = 'block';
                roughElement.style.margin = '0 auto';
                roughElement.style.boxSizing = 'border-box';
                
                // For canvas elements, we need to handle scaling differently
                if (roughElement.tagName.toLowerCase() === 'canvas') {
                  const originalWidth = roughElement.width;
                  const originalHeight = roughElement.height;
                  
                  // Set the CSS size while maintaining aspect ratio
                  roughElement.style.width = '100%';
                  roughElement.style.height = 'auto';
                  roughElement.style.objectFit = 'contain';
                  
                  console.log('Styled canvas element:', originalWidth + 'x' + originalHeight);
                } else {
                  // For SVG elements, copy viewBox if it exists
                  if (svg.getAttribute('viewBox')) {
                    roughElement.setAttribute('viewBox', svg.getAttribute('viewBox'));
                  }
                  console.log('Styled SVG element');
                }
              }
              
              console.log('Applied svg2roughjs effect to mermaid diagram');
              
            } catch (error) {
              console.warn('Could not apply svg2roughjs effect:', error);
              console.log('svg2roughjs object:', svg2roughjs);
              console.log('Available methods:', Object.getOwnPropertyNames(svg2roughjs.Svg2Roughjs.prototype));
            }
          });
        }

        document.addEventListener('DOMContentLoaded', function() {
          // Wait a bit to ensure mermaid is loaded
          setTimeout(renderMermaid, 100);
        });
      })();
    </script>
  </body>
</html>
